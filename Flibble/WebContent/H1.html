<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>H1</title>
    <!-- yui css -->
    <link rel="stylesheet" type="text/css" href="yui/build/reset-fonts-grids/reset-fonts-grids.css">
    <link rel="stylesheet" type="text/css" href="yui/build/base/base-min.css">
    <link rel="stylesheet" type="text/css" href="yui/build/button/assets/skins/sam/button.css">
    <link rel="stylesheet" type="text/css" href="yui/build/container/assets/skins/sam/container.css">
    <!-- yui js -->
    <script type="text/javascript" src="yui/build/yahoo-dom-event/yahoo-dom-event.js"></script>
    <script type="text/javascript" src="yui/build/animation/animation-min.js"></script>
    <script type="text/javascript" src="yui/build/element/element-beta-min.js"></script>
    <script type="text/javascript" src="yui/build/button/button-min.js"></script>
    <script type="text/javascript" src="yui/build/dragdrop/dragdrop-min.js"></script>
    <script type="text/javascript" src="yui/build/container/container-min.js"></script>
    <script type="text/javascript" src="yui/build/json/json-min.js"></script>
    <!-- custom css -->
    <link rel="stylesheet" href="css/main.css" />
    <!-- custom js -->
    <script type="text/javascript" src="js/prototype.js"></script>
    <script type="text/javascript" src="js/game.js"></script>
</head>
<body class="yui-skin-sam">

<div id='window-outer'>
<div id='window' class='window-h1'>
	<div id="H1">
		<img id="mainTitle" src="image/maintitle.png" />
		
		<div id="startGameButton" onclick='void startGame();'>Start Game</div>
		
		<div id="instructionsButton" onclick='void instructions();'>Instructions</div>
	</div>
</div>
</div>

<div id="startGamePanel">
	<div class="hd">Start Game</div>
	<div class="bd">
		<div id="startGameBody">
			<form action="H2.jsp" method="post">
				<h2>Nickname:</h2>
				<p><input type="text" name="nick" class="startGameInput" id="nick" /></p>
				<h2>Select table:</h2>
				<div id="tableSelection">
					<div class="table">
						Loading...
					</div>
				</div>
				<h2>or <a href="javascript: void submit($F('nick'), 0);">Create a new table</a></h2>
			</form>
		</div>
		
		<div class="closeButton" onclick="void panelStartGame.hide();">
			Close
		</div>
	</div>
	<div class="ft"></div>
</div>


<div id="instructionsPanel">
	<div class="hd">Instructions</div>
	<div class="bd">
		<div id="instructionsBody">
			<h1>About Flibble</h1>			
			<p>
				Flibble came out from a team of four NTU Info Sys students intended for the second assignment of CI6111 Internet Programming Course. 
				Flibble is a mashup game using Flickr as a data provider. The game players can get an excited and joyful time by playing Flibble.
				Flibble is just about matching pictures and their relevant texts.				
			</p>
			<h1>How to play Flibble</h1>			
			<div id="instructionh1"><p>***Create new game***</p></div>
			<p>1. Choose "Start Game" from the main page.</p>
		    <p>2. Enter your nick name and Click "Create a new table". 
		    <br>The system will create a new game table along with the nick name(you entered) and the table name (assigned by the system automatically).
		        The new game table will appeared in the game table list so that the next player can see your game table.
		    </p>		    
		    <p>3.You will see the waiting for status bar. 
		    <br>You can only enter into the game room when other player chooses your game table from the game table list.
		        If the next player chooses your game table, you two will reach into the game playing room.
		    </p>		    
		    <div id="instructionh1"><p>***Join an existing game***</p></div>
		    <p>1. Choose "Start Game" from the main page.</p>
		    <p>2. Enter the nick name and select one game table which is not full from the game table list. 
		    <br>You will be taken to the game playing room to compete with the player you selected.
		    </p>
		    <div id="instructionh1"><p>***Understanding game playing room***</p></div>
		    <p>You will see the two panels, left panel and right panel. 
		       In the left panel, you will see nine containers with some texts.
		       Actually, this table is belonged to your competitor.
		       In the right panel, you will see nine pictures. This is belonged to you.
		       You will also see two containers at top. One is in the left panel and another is in the right panel.
		       From the left top container, you will have to receive the picture from your competitor. 
		       Into the right top container, you have to drag one picture from your right panel to send the picture to your competitor.		       		       
		    </p>
		    <div id="instructionh1"><p>***Playing game***</p></div>
		    <p>1. If you are the game table creator, you have to start sending picture to your competitor by dragging one picture from the right panel into the right top container.
		    <br>Otherwise, you have to wait for the picture from your competitor. Let's consider you are the game creator so you send the picture to your competitor.
		    </p>		    
		    <p>2. In your competitor side, the picture you sent will appear at the left top container.
		    <br>Your competitor has to match the picture with the meaning of the texts of nine containers in the left panel.
		    </p>
		    <p>3. The competitor must drag the picture into one of nine containers that he think the meaning of the text in this container is described the meaning of the picture. 
		    <br>If he/she can guess correctly,the picture will be fixed at the container , he will be worth to increase his score.
		    The picture from your side will be disappeared.
			Otherwise, he/she don't get the score increase, the picture you sent will be disappeared from his side and it will be appeared in your side again.
			Then your competitor has to send a picture to you by drugging into the right top container.
			Suppose your competitor could make a correct guess.
			</p>			 	    
		    <p>4. You will receive the image from your competitor in the left top container. Now it is your turn to guess.
		    <br>If you can guess, your score will be increased, the picture your competitor sent will be appeared in the container of left panel
		    but this picture will be disappeared in your competitor's side. 
		    Otherwise, your score will not be increased, no picture will be appeared in left panel and the pictures in your competitor's side will also remain the same.
		    Now it is your competitor turn to guess.  
		    The game will continue like that until one player can fill all nine containers with the pictures in the left panel.
		    </p>		    
		
		</div>
		
		<div class="closeButton" onclick="void panelInstructions.hide();">
			Close
		</div>
	</div>
	<div class="ft"></div>
</div>

<script type="text/javascript">
var panelConfig = {
	width: "530px", 
	visible: false,
	fixedcenter: true,   
	draggable: true,
	close: true,
	modal: true,
	zindex: 4,
	constraintoviewport: true
};

var panelStartGame = new YAHOO.widget.Panel("startGamePanel", panelConfig);
panelStartGame.render();

var panelInstructions = new YAHOO.widget.Panel("instructionsPanel", panelConfig);
panelInstructions.render();

function startGame() {
	panelStartGame.show();
	Flibble.getTables(function(ret) {
		var Games = ret.Games;
		$('tableSelection').childElements().invoke('remove');
		for (var i = 0; i < Games.length; i++) {
			var game = Games[i];
			var table;
			if (game.GStatus == 'PLAYING') { 
				table = new Element('div', {class: 'table', style: 'background-color: #dd7777', onclick: "void alert('This table is full.');"}).update('PLAYING<br/>' + game.UserA + '<br/>' + game.UserB);
			} else if (game.GStatus == 'WAITING') {
				table = new Element('div', {class: 'table', style: 'background-color: #77dd77', onclick: "submit($F('nick'), '" + game.GameName + "')"}).update('WAITING<br/>' + game.UserA + '<br/>' + game.UserB);
			}
			$('tableSelection').appendChild(table);
		}
	});
}

function instructions() {
	panelInstructions.show();
}

function submit(nick, table) {
	if (! nick) {
		window.alert("Please fill in your nick name!");
		return;
	}
	
	Flibble.login(nick, function (ret) {
		if (ret.Status == FAILURE) {
			window.alert("Failed to register the nick name. Please choose another.");
			return;
		}
		
		if (table) {
			// join
			Flibble.joinGame(nick, table, function(ret) {
				if (ret.Status == FAILURE) {
					window.alert("Failed to join the game. Please choose another or create a new one.");
					return;
				}
				gotoNextPage(nick, table);
			});
		} else {
			// create
			Flibble.createGame(nick, function(ret) {
				if (ret.Status == FAILURE) {
					window.alert("Failed to create a new game. Please turn off your computer.");
					return;
				}
				gotoNextPage(nick, ret.gname); 
			});
		}
	});	
}

function gotoNextPage(nick, table) {
	document.location.href = 'H2.html?' + $H({nick: nick, table: table}).toQueryString();
}

</script>

</body>
</html>